<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± Ø§Ù„Ø´Ø®ØµÙŠ - Nouran Sameh</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <style>
        /* Ø¥Ø¶Ø§ÙØ© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ù‡Ù†Ø§ Ù…Ø«Ù„ Ø§Ù„Ø³Ø§Ø¨Ù‚ */
    </style>
</head>
<body>
    <!-- ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø®Ù„ÙÙŠØ© -->
    <div id="videoBackground" class="video-background">
        <video autoplay muted loop playsinline>
            <source src="https://michellegore.com/wp-content/uploads/2020/12/Background-Animation.mp4" type="video/mp4">
            Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ.
        </video>
        <div class="video-overlay"></div>
    </div>

    <!-- ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="loginPage" class="container">
        <div class="login-container">
            <div class="login-header">
                <h1><i class="fas fa-images"></i> Ù…Ø¹Ø±Ø¶ Ù†ÙˆØ±Ø§Ù†</h1>
                <p>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø®ØµÙŠ</p>
            </div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="username"><i class="fas fa-user"></i> Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                    <input type="text" id="username" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" required>
                </div>
                
                <div class="form-group">
                    <label for="password"><i class="fas fa-lock"></i> ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="password" id="password" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
                </div>
                
                <button type="submit" class="btn btn-block">
                    <i class="fas fa-sign-in-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                </button>
            </form>
            
            <div class="alert alert-danger hidden" id="loginError">
                <i class="fas fa-exclamation-circle"></i> 
                <span id="errorMessage">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©</span>
            </div>
        </div>
    </div>

    <!-- Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ -->
    <div id="dashboardPage" class="dashboard-container hidden">
        <!-- ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù‡Ù†Ø§ -->
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <script>
        const API_BASE_URL = 'https://nouran-server.vercel.app/api';
        
        const state = {
            currentUser: null,
            token: localStorage.getItem('token') || null,
            projects: [],
            currentImageFile: null,
            isUploading: false,
            loginTime: null
        };

        const loginPage = document.getElementById('loginPage');
        const dashboardPage = document.getElementById('dashboardPage');
        const loginForm = document.getElementById('loginForm');
        const loginError = document.getElementById('loginError');
        const errorMessage = document.getElementById('errorMessage');

        async function login(username, password) {
            try {
                const response = await fetch(`${API_BASE_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();
                
                if (data.success) {
                    state.token = data.token;
                    state.currentUser = data.user;
                    state.loginTime = new Date();
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('loginTime', state.loginTime.toISOString());
                    return true;
                } else {
                    throw new Error(data.error || 'ÙØ´Ù„ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:', error);
                throw new Error('ÙØ´Ù„ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
            }
        }

        function handleImageFile(file) {
            if (file.size > 5 * 1024 * 1024) {
                SweetAlert.fire({
                    title: 'âš ï¸ Ø­Ø¬Ù… ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹',
                    text: 'Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ù‚Ù„ Ù…Ù† 5 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª',
                    icon: 'warning'
                });
                return;
            }

            if (state.currentImageFile && state.currentImageFile.name === file.name) {
                SweetAlert.fire({
                    title: 'ğŸ’¡ ØµÙˆØ±Ø© Ù…Ù…Ø§Ø«Ù„Ø©',
                    text: 'Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨Ø§Ù„ÙØ¹Ù„ Ø¨ØªØ­Ù…ÙŠÙ„ Ù‡Ø°Ù‡ Ø§Ù„ØµÙˆØ±Ø©!',
                    icon: 'info'
                });
                return;
            }

            state.currentImageFile = file;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const imagePreview = document.getElementById('imagePreview'); // ØªØ¹Ø¯ÙŠÙ„ Ù„ÙŠØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„Ø¹Ù†ØµØ±
                imagePreview.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        loginForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            try {
                await login(username, password);
                // ØªØ§Ø¨Ø¹ Ù‡Ù†Ø§ Ø¥Ù„Ù‰ Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
            } catch (error) {
                loginError.classList.remove('hidden');
                errorMessage.textContent = error.message;
            }
        });

        // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø¨Ù‚ÙŠØ© Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙƒÙ…Ø§ Ù‡Ùˆ Ù…Ø·Ù„ÙˆØ¨
    </script>
</body>
</html>
